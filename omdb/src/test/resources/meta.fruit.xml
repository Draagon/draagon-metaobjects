<?xml version="1.0" encoding="ISO-8859-1" ?>

<metadata package="produce">

    <!-- Id -->
    <field name="id" subType="long" dbColumn="id" auto="last" />
    
    <!-- Fruit -->
    <object name="Fruit" subType="pojo" dbTable="FRUIT">
    
      <attr name="object" subType="string">com.metaobjects.manager.db.test.fruit.Fruit</attr>
      
      <!-- Id -->
      <field name="id" super="id"/>

      <!-- Type -->
      <field name="kind" subType="int" dbColumn="kind" />
            
      <!-- Name -->
      <field name="name" subType="string" dbColumn="name">
        <attr name="len" subType="int">50</attr>
      </field>
      
      <!-- Length -->
      <field name="length" subType="int" dbColumn="length"/>

      <!-- Weight -->
      <field name="weight" subType="int" dbColumn="weight"/>

      <!-- Primary Identity -->
      <identity name="primary" subType="primary">
        <attr name="fields" subType="stringarray">id</attr>
        <attr name="generation" subType="string">increment</attr>
      </identity>

    </object>  

    <!-- Apple -->
    <object name="Apple" super="Fruit" subType="pojo" dbTable="APPLE" dbView="APPLE_VIEW"
        dbViewSQL="SELECT F.*, A.* FROM FRUIT F, APPLE A WHERE F.id=A.fruit_id AND F.kind=1">
    
      <attr name="object" subType="string">com.metaobjects.manager.db.test.fruit.Apple</attr>
          
      <attr name="dbInheritance" subType="properties">
        superClass=produce::Fruit
	superJoiner=id
	joiner=fruitId
	discriminator=kind
	discriminatorValue=1
      </attr>
    
      <!-- Fruit Id -->
      <field name="fruitId" subType="long" dbColumn="FRUIT_ID" />

      <!-- Orachard -->
      <field name="orchard" subType="string" dbColumn="orchard">
        <attr name="len" subType="int">80</attr>
      </field>
     
      <!-- Worms -->
      <field name="worms" subType="int" dbColumn="worms"/>

    </object>  

    <!-- Orange -->
    <object name="Orange" super="Fruit" dbTable="ORANGE" dbView="ORANGE_VIEW"
        dbViewSQL="SELECT F.*, O.* FROM FRUIT F, ORANGE O WHERE F.id=O.fruit_id AND F.kind=2">
    
      <attr name="object" subType="string">com.metaobjects.manager.db.test.fruit.Orange</attr>    
            
      <attr name="dbInheritance" subType="properties">
        superClass=produce::Fruit
	superJoiner=id
	joiner=fruitId
	discriminator=kind
	discriminatorValue=2
      </attr>
    
      <!-- Fruit Id -->
      <field name="fruitId" subType="long" dbColumn="FRUIT_ID" />
    
      <!-- Picked Date -->
      <field name="pickedDate" subType="date" dbColumn="picked_dt"/>

    </object>
    
    <!-- Basket -->
    <object name="Basket" subType="value" package="container" dbTable="BASKET">

      <attr name="object" subType="string">com.metaobjects.object.value.ValueObject</attr>

      <!-- Primary Identity (new MetaIdentity system) -->
      <identity name="primary" subType="primary">
        <attr name="fields" subType="stringarray">id</attr>
        <attr name="generation" subType="string">increment</attr>
      </identity>

      <!-- Id -->
      <field name="id" super="produce::id"/>

      <!-- Number of apples -->
      <field name="apples" subType="int" dbColumn="apples"/>

      <!-- Number of oranges -->
      <field name="oranges" subType="int" dbColumn="oranges"/>

    </object>
    
    <!-- Basket -->
    <object name="FullBasketView" super="container::Basket" dbView="FULL_BASKET_VIEW"
        dbViewSQL="SELECT B.* FROM BASKET B WHERE b.apples+b.oranges > 10">
           
    </object>    
 
</metadata>
